{% load custom_filters %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Skill Assessment Report - Enskill</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* Your full CSS from the template */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container { max-width: 1200px; margin: 0 auto; }
        .report-card { background: white; border-radius: 16px; padding: 40px; margin-bottom: 20px; box-shadow: 0 10px 40px rgba(0,0,0,0.1); }
        .header { text-align: center; margin-bottom: 40px; }
        .header h1 { color: #1f2937; font-size: 2.5em; margin-bottom: 10px; }
        .header p { color: #6b7280; font-size: 1.1em; }
        .summary-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 40px; }
        .summary-item { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 25px; border-radius: 12px; color: white; text-align: center; }
        .summary-item h3 { font-size: 0.9em; font-weight: 500; margin-bottom: 10px; opacity: 0.9; }
        .summary-item .value { font-size: 2.5em; font-weight: bold; margin-bottom: 5px; }
        .summary-item .label { font-size: 0.85em; opacity: 0.8; }
        .section { margin-bottom: 40px; }
        .section-title { color: #1f2937; font-size: 1.8em; margin-bottom: 20px; padding-bottom: 10px; border-bottom: 3px solid #667eea; }
        .competency-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .competency-card { background: #f9fafb; padding: 20px; border-radius: 10px; border-left: 4px solid #667eea; }
        .competency-card h4 { color: #1f2937; font-size: 1.1em; margin-bottom: 10px; text-transform: capitalize; }
        .score-bar { background: #e5e7eb; height: 12px; border-radius: 6px; overflow: hidden; margin: 10px 0; }
        .score-fill { height: 100%; background: linear-gradient(90deg, #667eea 0%, #764ba2 100%); transition: width 1s ease; }
        .performance-level { display: inline-block; padding: 4px 12px; border-radius: 20px; font-size: 0.85em; font-weight: 600; margin-top: 10px; }
        .level-advanced { background: #d1fae5; color: #065f46; }
        .level-proficient { background: #dbeafe; color: #1e40af; }
        .level-developing { background: #fef3c7; color: #92400e; }
        .level-emerging { background: #fed7aa; color: #9a3412; }
        .level-novice { background: #fee2e2; color: #991b1b; }
        .strength-weakness-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 30px; }
        .strength-card, .weakness-card { padding: 25px; border-radius: 12px; }
        .strength-card { background: linear-gradient(135deg, #d4fc79 0%, #96e6a1 100%); }
        .weakness-card { background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%); }
        .strength-card h3, .weakness-card h3 { margin-bottom: 15px; font-size: 1.3em; }
        .item-list { list-style: none; }
        .item-list li { padding: 10px; background: rgba(255,255,255,0.5); margin-bottom: 10px; border-radius: 6px; font-weight: 500; }
        .course-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; }
        .course-card { background: #fff; border: 2px solid #e5e7eb; padding: 20px; border-radius: 10px; transition: transform 0.3s, box-shadow 0.3s; }
        .course-card:hover { transform: translateY(-5px); box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        .course-badge { display: inline-block; padding: 4px 10px; border-radius: 12px; font-size: 0.75em; font-weight: 600; margin-bottom: 10px; }
        .badge-priority { background: #fee2e2; color: #991b1b; }
        .badge-complementary { background: #dbeafe; color: #1e40af; }
        .badge-advanced { background: #d1fae5; color: #065f46; }
        .course-card h4 { color: #1f2937; font-size: 1.1em; margin-bottom: 10px; }
        .course-card p { color: #6b7280; font-size: 0.9em; line-height: 1.6; margin-bottom: 10px; }
        .course-duration { color: #667eea; font-weight: 600; font-size: 0.85em; }
        .chart-container { max-width: 600px; margin: 30px auto; padding: 20px; background: white; border-radius: 10px; }
        .action-plan { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; border-radius: 12px; }
        .action-plan h3 { margin-bottom: 20px; font-size: 1.5em; }
        .action-list { list-style: none; }
        .action-list li { padding: 15px; background: rgba(255,255,255,0.1); margin-bottom: 15px; border-radius: 8px; border-left: 4px solid white; }
        .action-list strong { display: block; margin-bottom: 5px; font-size: 1.1em; }
        .btn { display: inline-block; padding: 12px 30px; background: #667eea; color: white; text-decoration: none; border-radius: 8px; font-weight: 600; transition: background 0.3s; }
        .btn:hover { background: #5568d3; }
        .btn-secondary { background: #6b7280; }
        .btn-secondary:hover { background: #4b5563; }
        .button-group { display: flex; gap: 15px; margin-top: 30px; justify-content: center; }
        @media (max-width: 768px) { .strength-weakness-grid, .summary-grid { grid-template-columns: 1fr; } }
    </style>
</head>
<body>
    <div class="container">
        <div class="report-card">
            <div class="header">
                <h1>ðŸŽ“ Skill Assessment Report</h1>
               <p>{{ student.name }} | {{ student.department }}</p> 
            </div>
            
            <!-- Executive Summary -->
            <div class="summary-grid">
                <div class="summary-item top">
                    <h3>National Rank</h3>
                     <div class="value">#{{ rank }}</div>
                    <div class="label">Out of all candidates</div>
                </div>
                <div class="summary-item high">
                    <h3>Percentile</h3>
                    <div class="value">{{ percentile }}%</div>
                <div class="label">{{ performance_category }}</div>
                </div>
                <div class="summary-item strong">
                    <h3>Total Score</h3>
                    <div class="value">{{ total_score|floatformat:0 }}</div>
                    <div class="label">Out of 100 Points</div>
                </div>
            </div>
         <!-- Competency Breakdown -->
            <div class="section">
                <h2 class="section-title">ðŸ“Š Competency Breakdown</h2>
                
                <div class="chart-container">
                
                    <canvas id="radarChart"></canvas>
                </div>
                
                <div class="competency-grid">
                    {% for comp in competency_scores %}
                    <div class="competency-card">
                        <h4>{{ comp.competency_name|cut:"_"|title }}</h4>

                    
                        <div class="score-bar">
                            <div class="score-fill" style="width: {{ comp.percentage }}%"></div>
                        </div>
                        <strong>{{ comp.percentage|floatformat:1 }}%</strong>
                        <span class="performance-level level-{{ comp.performance_level }}">{{ comp.get_performance_level_display }}</span>
                        {% if comp.is_strength %}
                        <span class="badge badge-strength">ðŸ’ª Strength</span>
                        {% elif comp.is_weakness %}
                        <span class="badge badge-weakness">ðŸ“ˆ Growth Area</span>
                        {% endif %}
                    </div>
                    {% endfor %}
                </div>
            </div>
          


            <!-- Strengths and Weaknesses -->

            
            <div class="section">
                <h2 class="section-title">ðŸ’ª Strengths & Growth Areas</h2>
                
             <div class="strength-weakness-grid">
    <div class="strength-card">
        <h3>âœ¨ Your Strengths</h3>
        <ul class="item-list">
            {% for comp in competency_scores %}
                {% if comp.is_strength %}
                    <li>
                        <strong>{{ comp.competency_name|cut:"_"|title }}</strong>
                        <span style="float:right;">{{ comp.percentage|floatformat:1 }}%</span>
                    </li>
                {% endif %}
            {% endfor %}
        </ul>
    </div>
    <div class="weakness-card">
        <h3>ðŸŽ¯ Growth Opportunities</h3>
        <ul class="item-list">
            {% for comp in competency_scores %}
                {% if comp.is_weakness %}
                    <li>
                        <strong>{{ comp.competency_name|cut:"_"|title }}</strong>
                        <span style="float:right;">{{ comp.percentage|floatformat:1 }}%</span>
                    </li>
                {% endif %}
            {% endfor %}
        </ul>
    </div>
</div>

            </div>
            
<!-- Improvement Priorities -->
<div class="section">
    <h2 class="section-title">ðŸŽ¯ Improvement Priorities</h2>

    <table style="width:100%; border-collapse: collapse; margin-top:10px;">
        <thead>
            <tr style="background:#f3f4f6;">
                <th style="padding:10px; text-align:left;">Competency</th>
                <th style="padding:10px; text-align:center;">Current Score</th>
                <th style="padding:10px; text-align:center;">Priority Score</th>
            </tr>
        </thead>

        <tbody>
            {% for p in improvement_priorities %}
            <tr style="border-bottom:1px solid #e5e7eb;">
                <td style="padding:10px;">
                    <strong>{{ p.competency_name|cut:"_"|title }}</strong>
                </td>

                <td style="padding:10px; text-align:center; color:#374151;">
                    {{ p.percentage }}%
                </td>

                <td style="
                    padding:10px;
                    text-align:center;
                    font-weight:600;
                    color:#4f46e5;
                ">
                    {{ p.priority_score }}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

            
         <!-- Recommended Courses -->
    <div class="section">
        <h2 class="section-title">ðŸ“š Recommended Courses</h2>

        <h3 style="color:#991b1b;">ðŸ”´ Priority Courses</h3>
        <div class="course-grid">
            {% for course in recommended_courses.priority_courses %}
            <div class="course-card">
                <span class="course-badge badge-priority">Priority</span>
                <h4>{{ course }}</h4>
            </div>
            {% endfor %}
        </div>

        <h3 style="color:#1e40af;">ðŸ”µ Complementary Courses</h3>
        <div class="course-grid">
            {% for course in recommended_courses.complementary_courses %}
            <div class="course-card">
                <span class="course-badge badge-complementary">Complementary</span>
                <h4>{{ course }}</h4>
            </div>
            {% endfor %}
        </div>

        <h3 style="color:#065f46;">ðŸŸ¢ Advanced Courses</h3>
        <div class="course-grid">
            {% for course in recommended_courses.advanced_courses %}
            <div class="course-card">
                <span class="course-badge badge-advanced">Advanced</span>
                <h4>{{ course }}</h4>
            </div>
            {% endfor %}
        </div>
    </div>

            
      <!-- Action Plan -->
    <div class="section">
        <div class="action-plan">
            <h3>ðŸš€ Your Action Plan</h3>

            <ul class="action-list">
                <li><strong>Next 30 Days</strong>
                    <ul>
                        {% for step in action_plan.30_days %}
                            <li>{{ step }}</li>
                        {% endfor %}
                    </ul>
                </li>

                <li><strong>Next 90 Days</strong>
                    <ul>
                        {% for step in action_plan.90_days %}
                            <li>{{ step }}</li>
                        {% endfor %}
                    </ul>
                </li>

                <li><strong>6â€“12 Months</strong>
                    <ul>
                        {% for step in action_plan.6_12_months %}
                            <li>{{ step }}</li>
                        {% endfor %}
                    </ul>
                </li>
            </ul>
        </div>
    </div>


    <!-- Career Path Recommendation -->
<div class="section">
    <h2 class="section-title">ðŸ›£ Career Path Suggestion</h2>

    <div class="competency-card" style="background:#eef2ff;">
        <p style="font-size:1.1em; color:#4338ca;">{{ career_path }}</p>
    </div>
</div>


<!-- Bloom's Taxonomy Mapping -->
<div class="section">
    <h2 class="section-title">ðŸŒ± Bloomâ€™s Taxonomy Level per Skill</h2>
    <div class="competency-grid">
        {% for comp in competency_scores %}
        <div class="competency-card">
            <h4>{{ comp.competency_name|cut:"_"|title }}</h4>
            <p><strong>Bloom Level:</strong> {{ blooms|get_item:comp.competency_name }}</p>
        </div>
        {% endfor %}
    </div>
</div>


<!-- Skill-to-Job-Role Mapping -->
<div class="section">
    <h2 class="section-title">ðŸ’¼ Skill â†’ Job Role Mapping</h2>
    <div class="competency-grid">
        {% for comp in competency_scores %}
        <div class="competency-card">
            <h4>{{ comp.competency_name|cut:"_"|title }}</h4>
            <ul>
                {% for job in job_roles|get_item:comp.competency_name %}
                    <li>{{ job }}</li>
                {% endfor %}
            </ul>
        </div>
        {% endfor %}
    </div>
</div>


<!-- Domain Strength Mapping -->
<div class="section">
    <h2 class="section-title">ðŸ“‚ Domain Strength Mapping</h2>
    <div class="competency-grid">
        {% for comp in competency_scores %}
        <div class="competency-card">
            <h4>{{ comp.competency_name|cut:"_"|title }}</h4>
            <p><strong>Domain:</strong> {{ domain_strength_map|get_item:comp.competency_name }}</p>
        </div>
        {% endfor %}
    </div>
</div>


<!-- Foundational & Behavioral Skills -->
<div class="section">
    <h2 class="section-title">ðŸ§© Foundational / Behavioral Skills</h2>
    <div class="competency-card">
        <ul class="item-list">
            {% for skill in foundational_skills %}
                <li>{{ skill }}</li>
            {% endfor %}
        </ul>
    </div>
</div>



    <!-- Algorithm details -->

<div class="section">
    <h2 class="section-title">ðŸ§  Algorithm Details (Bonus)</h2>

    <div class="competency-card">
        <h4>Marks Per Competency</h4>
        <ul>
            {% for key, val in algorithm.scoring_marks.items %}
                <li><strong>{{ key|cut:"_"|title }}:</strong> {{ val }} marks</li>
            {% endfor %}
        </ul>
    </div>

    <div class="competency-card">
        <h4>Maximum Possible Scores</h4>
        <ul>
            {% for key, val in algorithm.max_scores.items %}
                <li><strong>{{ key|cut:"_"|title }}:</strong> {{ val }} points</li>
            {% endfor %}
        </ul>
    </div>

    <div class="competency-card">
        <h4>Performance Thresholds</h4>
        <ul>
            {% for level, threshold in algorithm.performance_thresholds.items %}
                <li><strong>{{ level|title }}:</strong> {{ threshold }}</li>
            {% endfor %}
        </ul>
    </div>

    <div class="competency-card">
        <h4>Strength & Weakness Rules</h4>
        <p><strong>Strength:</strong> {{ algorithm.strength_rule }}</p>
        <p><strong>Weakness:</strong> {{ algorithm.weakness_rule }}</p>
    </div>

    <div class="competency-card">
        <h4>Improvement Priority Formula</h4>
        <p>{{ algorithm.improvement_priority_formula }}</p>
    </div>

    <div class="competency-card">
        <h4>Competency Weights</h4>
        <ul>
            {% for key, val in algorithm.competency_weights.items %}
                <li><strong>{{ key|cut:"_"|title }}:</strong> {{ val }}</li>
            {% endfor %}
        </ul>
    </div>
</div>


</div>
</div>


            
            <div class="button-group">
                <a href="#" class="btn">Back to Dashboard</a>
                <a href="#" class="btn btn-secondary">View Leaderboard</a>
            </div>
        </div>
    </div>
    
<script>
const ctx = document.getElementById('radarChart').getContext('2d');

const labels = [
    {% for comp in competency_scores %}
        "{{ comp.competency_name|cut:'_'|title }}"{% if not forloop.last %}, {% endif %}
    {% endfor %}
];

const dataValues = [
    {% for comp in competency_scores %}
        {{ comp.percentage|floatformat:1 }}{% if not forloop.last %}, {% endif %}
    {% endfor %}
];

new Chart(ctx, {
    type: 'bar',
    data: {
        labels: labels,
        datasets: [{
            label: 'Your Performance (%)',
            data: dataValues,
            backgroundColor: 'rgba(102, 126, 234, 0.6)',
            borderColor: 'rgb(102, 126, 234)',
            borderWidth: 2,
        }]
    },
    options: {
        scales: {
            y: {
                beginAtZero: true,
                suggestedMax: 100
            }
        },
        plugins: {
            legend: { display: false }
        }
    }
});
</script>


</body>
</html>
